<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Spatio-Temporal / NEON Data Workshop  &#8211; Spatio-Temporal Data Hackathon</title>
<meta name="description" content="">
<meta name="keywords" content="">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Spatio-Temporal / NEON Data Workshop ">
<meta property="og:description" content="Hackathon held October 21-23 in Boulder, CO at NEON headquarters.">
<meta property="og:url" content="http://localhost:4000/R/spatio-temporal/">
<meta property="og:site_name" content="Spatio-Temporal Data Hackathon">





<link rel="canonical" href="http://localhost:4000/R/spatio-temporal/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Spatio-Temporal Data Hackathon Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.min.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">


<link rel="stylesheet" href="/assets/highlightjs/styles/zenburn.css">
<script src="/assets/highlightjs/highlight.packR.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
<div class="NEON-header">
<img src="/images/banners/header_whole.png" alt="NEON" style="width:100%;">
</div>
	<div class="site-name">
		<a href="http://localhost:4000">Spatio-Temporal Data Hackathon</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				<li><a href="http://localhost:4000/about/" >About</a></li>
		        
				<li><a href="http://localhost:4000/agenda/" >Agenda</a></li>
		        
				<li><a href="http://www.neoninc.org" target="_blank">NEON Website</a></li>
		        
				<li><a href="http://www.datacarpentry.org" target="_blank">Data Carpentry Website</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->





<div id="main" role="main">
  <div class="article-author-side">

    

	 <img src="http://localhost:4000/images/profilePic.png" class="bio-photo" alt="NEON / Data Carpentry Hackathon bio photo"></a>



<h3>NEON / Data Carpentry Hackathon</h3>
<p>Devoted to open data and open source in science and education.</p>


<h3>Activities By Topic</h3>


  
    
      <h5><a href="/module-1">Raster and Vector Data  
    
  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
      <h5><a href="/module-2">Spatial Data Viz - Maps  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
      <h5><a href="/module-3">Time Series  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
  
    
      <h5><a href="/module-4">Remote Sensing  
    
   
      (1) 
     </a></h5>
 

<!--
<h4><a href="/activities/">View ALL Activities</a></h4>
<h4><a href="/activities-by-tag/">Activities by Tag</a></h4>

-->
<br><br><br>









<a href="http://github.com/lwasser" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>







<br><br><br>


  </div>
  <article>
    <div class="headline-wrap">
      
        <h1><a href="http://localhost:4000/R/spatio-temporal/" rel="bookmark" title="Spatio-Temporal / NEON Data Workshop ">Spatio-Temporal / NEON Data Workshop </a></h1>
      
    </div><!--/ .headline-wrap -->

    <div class="article-wrap">
      <section id="table-of-contents" class="toc">
  <header>
    <h3>Contents</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#p1-the-geospatial-landscape" id="markdown-toc-p1-the-geospatial-landscape">P1. The Geospatial Landscape</a></li>
  <li><a href="#p2-work-with-raster-and-vector-data-in-r" id="markdown-toc-p2-work-with-raster-and-vector-data-in-r">P2. Work With Raster and Vector Data In R</a></li>
  <li><a href="#p2b-working-with-raster-time-series-data" id="markdown-toc-p2b-working-with-raster-time-series-data">P2b. Working with Raster Time Series Data</a></li>
  <li><a href="#p3-project-organization--metadata" id="markdown-toc-p3-project-organization--metadata">P3. Project Organization &amp; Metadata</a></li>
  <li><a href="#p4-working-with-csv-format-time-series-data" id="markdown-toc-p4-working-with-csv-format-time-series-data">P4. Working with CSV format Time Series Data</a></li>
  <li><a href="#p5-data-viz" id="markdown-toc-p5-data-viz">P5. Data Viz</a></li>
  <li><a href="#p7-an-automated-workflow" id="markdown-toc-p7-an-automated-workflow">P7. An automated workflow</a></li>
  <li><a href="#remote-sensing-workshop" id="markdown-toc-remote-sensing-workshop">Remote Sensing Workshop</a></li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<h1 id="overview">Overview</h1>

<h2 id="persona">Persona</h2>

<p>Jessica, is putting together her dissertation proposal as a part of her PHD program in ecology at University of Boulder, CO.  She is interested in exploring some of her field sites to understand how phenology of vegetation (greening in the spring summer and senescence in the winter, varies across multiple sites and through time. Her PhD advisor has given her some data for a few sites which have very different vegetation communities including Harvard Forest (Massachusetts) and San Joachin Experimental Range (California). The data include:</p>

<p>1.Vegetation greenness (NDVI) derived from the Landsat Satellite (30 meter resolution) for both sites for 2 years derived from the landsat sensor in a raster format.
2. Some high resolution images of the sites.
3. A canopy height model showing tree height
4. A DEM (digital elevation model) showing topography.
5. Site temperature, PAR (Photosynthetic active radiation), Soil temperature, Precipitation and daylength for each day over those two years</p>

<p>Jessica has done some of the things above using her favorite open source GIS tool - QGIS. However that workflow makes it difficult to process and look at multiple years worth of data. She wants to create an efficient reproducible workflow that she can use as she collects data for more sites and years over time to support her dissertation work. She has never opened shapefiles and rasters in a non-gui environment. She also understands what a raster is but doesn’t know where the ndvi data come from.</p>

<p>Jessica would like to create the following outputs to better understand her project:</p>

<ul>
  <li>Plots of temperature, precipitation, PAR and daylength over the 2 year time period (metrics which related to the greening and browning of plants)  compared to NDVI (greenness).</li>
  <li>Basemaps of her site showing</li>
  <li>The location of the tower that measured the above variables and imagery showing what the site look like.
tree height</li>
  <li>Topography</li>
  <li>A time series animation of NDVI for both sites that she can post on her blog.</li>
</ul>

<h1 id="p1-the-geospatial-landscape">P1. The Geospatial Landscape</h1>

<p><strong>stuff here</strong></p>

<h1 id="p2-work-with-raster-and-vector-data-in-r">P2. Work With Raster and Vector Data In R</h1>

<p>Goal: Participants will know how to  import raster and vector data in R, view metadata / attributes of each in R.</p>

<h2 id="learning-objectives">Learning Objectives:</h2>

<ul>
  <li>Understand the difference between vector and raster data (could be covered in P1)</li>
  <li>Know how to open up a shapefile in R (brief explanation of shapefile)</li>
  <li>Understand point, line and polygons</li>
  <li>Know how to open a raster data file in R (brief explanation of geotiff)</li>
  <li>Know how to create a basic map of a raster with a shapefile overlayed.</li>
</ul>

<p>Below is some code to look at the data and get this module started.. lots more to
add!</p>

<pre><code>#work with rasters
library(raster)
#best for importing shapefiles
library(rgdal) 
#plotting
library(ggplot2)

options(stringsAsFactors = FALSE)

#set the working directory
setwd("~/Documents/data/1_DataPortal_Workshop")
</code></pre>

<h3 id="first-plot-the-basemap-to-see-where-the-tower-boundary-is">First plot the basemap to see where the tower boundary is.</h3>

<p>Note, this will require opening up the geotiff imagery for the site.
Then plotting</p>

<p>CRS: UTM ZONE 18N FOR HARVARD</p>

<pre><code>#import imagery
chm &lt;- raster("NEON_RemoteSensing/HARV/CHM/HARV_chmCrop.tif")
#plot chm (make map?)
plot(chm, main="NEON Canopy Height Model (Tree Height)\nHarvard Forest")
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/view-basemap-1.png" alt=" " /></p>

<pre><code>#customize legend, add units (m), remove x and y labels
</code></pre>

<h3 id="opening-a-multi-band-image-is-different-from-opening-a-single-band-image">opening a multi-band image is different from opening a single band image</h3>
<p>We need to use the stack command for this…</p>

<p>more here..</p>

<pre><code>################### IMPORT MULTI BAND RASTER (image) #########################
#note that when you import a multi band image you have to import it as a stack 
#rather than a raster... this might be worth pointing out in the lesson.
#it could be good to start with just a single band raster like a CHM, DEM etc?

baseImage &lt;- stack("NEON_RemoteSensing/HARV/HARV_RGB_Ortho.tif")

#plot the image for the site
#is there a way to plot RGB and add titles, etc (data viz group??)
plotRGB(baseImage,r=1,g=2,b=3, 
        main="Harvard Tower Site")
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/import-rgb-image-1.png" alt=" " /></p>

<h3 id="vector-data-are-different-from-raster">vector data are different from raster</h3>

<p>More here on vectors…</p>

<p>Open a point, line and polygon layer here.
NOTE: need to add line and point!</p>

<p>ogr is better than maptools (IMO) :) … why</p>

<pre><code>#Import the shapefile 
#note: read ogr is preferred as it maintains prj info
squarePlot &lt;- readOGR("boundaryFiles/HARV/","HarClip_UTMZ18")

## OGR data source with driver: ESRI Shapefile 
## Source: "boundaryFiles/HARV/", layer: "HarClip_UTMZ18"
## with 1 features
## It has 1 fields

#view attributes
squarePlot

## class       : SpatialPolygonsDataFrame 
## features    : 1 
## extent      : 732128, 732251.1, 4713209, 4713359  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## variables   : 1
## names       : id 
## min values  :  1 
## max values  :  1

#view crs
crs(squarePlot)

## CRS arguments:
##  +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84
## +towgs84=0,0,0

#view extent
extent(squarePlot)

## class       : Extent 
## xmin        : 732128 
## xmax        : 732251.1 
## ymin        : 4713209 
## ymax        : 4713359

#look at the polygon
plot(squarePlot, col="purple")
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/work-with-vectors-1.png" alt=" " /></p>

<pre><code>#look at the polygon on top of the imagery
plotRGB(baseImage)

#add the plot boundary to the image. Make it a transparent box with a thick outline
#Note: leah needs to fix the crop box to make it UTM z18 friendly! it will happen.
plot(squarePlot, col="yellow", add=TRUE)

#open a line shapefile
#NOte: this file has attributes so the viz group should work on 
#making maps with multi attribute shapefiles
#adding legends, etc
roads &lt;- readOGR("boundaryFiles/HARV/","HARV_roadStream")

## OGR data source with driver: ESRI Shapefile 
## Source: "boundaryFiles/HARV/", layer: "HARV_roadStream"
## with 13 features
## It has 15 fields

plot(roads, col="yellow", add=TRUE)

#add a point
tower &lt;- readOGR("boundaryFiles/HARV/","HARVtower_UTM18N")

## OGR data source with driver: ESRI Shapefile 
## Source: "boundaryFiles/HARV/", layer: "HARVtower_UTM18N"
## with 1 features
## It has 14 fields

#make this a cooler symbol
plot(tower, col="red", add=TRUE)
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/work-with-vectors-2.png" alt=" " /></p>

<h3 id="crop-the-base-image-to-the-aoi">Crop the Base Image to the AOI</h3>

<p>This is the area used to clip the NDVI data from. We can expand it a bit.
Concerned with size but i think a bit larger could be ok.</p>

<pre><code>#crop the image to the plot boundary?
#note that crop just uses the extent - not that actual shape of the polygon.
new &lt;- crop(baseImage,squarePlot)

plotRGB(new, axes=F,main="RGB image cropped")
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/crop-image-1.png" alt=" " /></p>

<pre><code>#not sure how to add a title to plotRGB??

#export geotiff
#write the geotiff - change overwrite=TRUE to overwrite=FALSE if you want to 
#make sure you don't overwrite your files!
writeRaster(new,"new","GTiff", overwrite=TRUE)
</code></pre>

<h1 id="p2b-working-with-raster-time-series-data">P2b. Working with Raster Time Series Data</h1>

<p>Goal: Participants will know how to work with, extract values from  and plot a set of rasters in R.</p>

<h3 id="learning-objectives-1">Learning Objectives:</h3>

<ul>
  <li>Know how to open a set of rasters in R as a raster stack</li>
  <li>Know how to plot a raster stack.</li>
  <li>Know how to extract values from a raster</li>
  <li>Know how to extract multiple values from a raster and plot it using GGPLOT.</li>
</ul>

<p>Import the NDVI time series.</p>

<h2 id="note-we-could-crop-these-to-a-larger-boundary-right-now-they-are-about-15mb">NOTE: we could crop these to a larger boundary. right now they are about 1.5mb</h2>
<p>##a tile…</p>

<pre><code>#define the path to write tiffs
#the other time series for the california sites is in NDVI/D17
#Note: if it's best we can also remove the nesting of folders here. I left it
#just to remember where i got the data from originally! i can just include a note to myself.
tifPath &lt;- "Landsat_NDVI/HARV/2011/"

#open up the cropped files
#create list of files to make raster stack
allCropped &lt;-  list.files(tifPath, full.names=TRUE, pattern = ".tif$")

#create a raster stack from the list
rastStack &lt;- stack(allCropped)

#layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
#would like to figure out how to plot these with 2-3 in each row rather than 4
plot(rastStack, zlim=c(1500,10000),nc=3)
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/process-NDVI-images-HARV-1.png" alt=" " /></p>

<pre><code>#VIZ people can show us how to customize the title on the plots
#Viz people can show us how to adjust the LAYOUT so the figures
#are easier to read...

#adjust the layout
#par(mfrow=c(7,2))
#not sure how to plot fewer columns without throwing errors

#plot histograms for each image
hist(rastStack,xlim=c(1500,10000))

#create data frame, calculate NDVI
ndvi.df.HARV &lt;- as.data.frame(matrix(-999, ncol = 2, nrow = length(allCropped)))
colnames(ndvi.df.HARV) &lt;- c("julianDays", "meanNDVI")
i &lt;- 0
for (crop in allCropped){
  i=i+1
  #open raster
  imageCrop &lt;- raster(crop)
  
  #calculate the mean of each
  ndvi.df.HARV$meanNDVI[i] &lt;- cellStats(imageCrop,mean) 
  
  #grab julian days
  ndvi.df.HARV$julianDays[i] &lt;- substr(crop,nchar(crop)-21,nchar(crop)-19)
}

ndvi.df.HARV$yr &lt;- as.integer(2009)
ndvi.df.HARV$site &lt;- "HARV"
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/process-NDVI-images-HARV-2.png" alt=" " /></p>

<h3 id="plot-ndvi-for-2011">PLOT NDVI for 2011</h3>

<p>NOTE: will add tiles for 2009-2010 - have 30 years but that is a lot!
###should we expand the extent or not?
LOOK UP:
###how to connect the dots in the NDVI ggplot??</p>

<p>Now, let’s plot NDVI for one year</p>

<p>NOTE: there are some bad points in the data. this is because of extreme cloud cover in the imagery. I will try to make a few images we can look at to see that these scenes are bad. It might be good for
the remote sensing group to cover this.</p>

<h3 id="note---there-is-a-dc-lesson-on-ggplot-that-we-might-be-able-to">NOTE - there is a DC lesson on GGPLOT that we might be able to</h3>
<p>###adapt to this!</p>

<pre><code>##plot stuff
#need to figure out the best plotting method to connect the dots! Or a better input format object
#we also should remove bad points in this layer and explain why the points are bad 
#cloud cover)
ggplot(ndvi.df.HARV, aes(julianDays, meanNDVI)) +
  geom_point(size=4,colour = "blue") + 
  ggtitle("NDVI for HARVARD forest 2011\nLandsat Derived") +
  xlab("Julian Days") + ylab("Mean NDVI") +
  theme(text = element_text(size=20))
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/plot-mean-NDVI-1.png" alt=" " /></p>

<h3 id="below-is-the-same-analysis-for-another-site-for-the-same-time-period">Below is the same analysis for another site for the same time period!</h3>
<p>THe data are for california field site san Joachin experimental range.
This might be an option additional activity to compare the two! Note
that hte NDVI values are generally lower as it’s a scrubby medit environment.
We can include photographs of the sites as well!
The data are very interesting!</p>

<pre><code>#define the path to write tiffs
tifPath &lt;- "Landsat_NDVI/SJER/2011/"

#open up the cropped files
#create list of files to make raster stack
allCropped &lt;-  list.files(tifPath, full.names=TRUE, pattern = ".tif$")

#create a raster stack from the list
rastStack &lt;- stack(allCropped)

#layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
#would like to figure out how to plot these with 2-3 in each row rather than 4
plot(rastStack, zlim=c(1500,10000),nc=3)
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/process-NDVI-images-SJER-1.png" alt=" " /></p>

<pre><code>#adjust the layout
#par(mfrow=c(7,2))
#not sure how to plot fewer columns without throwing errors

#plot histograms for each image
hist(rastStack,xlim=c(1500,10000))

## Warning in .local(x, ...): only the first 16 layers are plotted
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/process-NDVI-images-SJER-2.png" alt=" " /></p>

<pre><code>#create data frame, calculate NDVI
ndvi.df.SJER &lt;- as.data.frame(matrix(-999, ncol = 2, nrow = length(allCropped)))
colnames(ndvi.df.SJER) &lt;- c("julianDays", "meanNDVI")
i &lt;- 0
for (crop in allCropped){
  i=i+1
  #open raster
  imageCrop &lt;- raster(crop)
  
  #calculate the mean of each
  ndvi.df.SJER$meanNDVI[i] &lt;- cellStats(imageCrop,mean) 
  
  #grab julian days
  ndvi.df.SJER$julianDays[i] &lt;- substr(crop,nchar(crop)-21,nchar(crop)-19)
}

ndvi.df.SJER$yr &lt;- as.integer(2011)
ndvi.df.SJER$site &lt;- "SJER"

#plot NDVI
ggplot(ndvi.df.SJER, aes(julianDays, meanNDVI)) +
  geom_point(size=4,colour = "blue") + 
  ggtitle("NDVI for SJER 2011\nLandsat Derived") +
  xlab("Julian Days") + ylab("Mean NDVI") +
  theme(text = element_text(size=20))
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/process-NDVI-images-SJER-3.png" alt=" " /></p>

<h2 id="animated-gifs-of-time-series-in-r">Animated Gifs of Time Series in R!</h2>

<p>Below is simple code to create an animation from a rasterstack.</p>

<pre><code>#create animation ot the NDVI outputs
library(animation)

#if(!file.exists("ndvi.gif")) { # Check if the file exists
  saveGIF(
    for (i in 1:length(allCropped)) {
                      plot(rastStack[[i]],
                      main=names(rastStack[[i]]),
                      legend.lab="NDVI",
                      col=rev(terrain.colors(30)),
                      zlim=c(1500,10000) )
      }, 
    movie.name = "ndvi.gif", 
    ani.width = 300, ani.height = 300, 
    interval=.5)

## Executing: 
## 'convert' -loop 0 -delay 50 Rplot1.png Rplot2.png Rplot3.png
##     Rplot4.png Rplot5.png Rplot6.png Rplot7.png Rplot8.png
##     Rplot9.png Rplot10.png Rplot11.png Rplot12.png Rplot13.png
##     Rplot14.png Rplot15.png Rplot16.png Rplot17.png 'ndvi.gif'
## Output at: ndvi.gif

## [1] TRUE

#}
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/create-animation-1.png" alt=" " /></p>

<h2 id="the-animated-gif">The animated gif!</h2>

<p><img src="/images/rfigs/2015-10-10-work-with-NDVI-daylength/ndvi.gif" alt="NDVI time series animation" /></p>

<p>Time series for NDVI for 2011 at Harvard Forest
#note it is easy to get more years as well!</p>

<pre><code>#Compare the two sites
ndvi.df &lt;- rbind(ndvi.df.SJER,ndvi.df.HARV)  
  
#plot NDVI
#make it look prettier
ggplot(ndvi.df, aes(julianDays, meanNDVI, colour=site)) +
  geom_point(size=4,aes(group=site)) + geom_line(aes(group=site))+
  ggtitle("NDVI HARV vs. SJER 2011\nLandsat Derived") +
  xlab("Julian Days") + ylab("Mean NDVI") +
  theme(text = element_text(size=20))
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/unnamed-chunk-1-1.png" alt=" " /></p>

<pre><code>#the end of this section  
</code></pre>

<h1 id="p3-project-organization--metadata">P3. Project Organization &amp; Metadata</h1>

<p><strong>Goal:</strong> Participants will understand how to organize a project with geospatial data and what metadata are most important to look at.</p>

<h2 id="learning-objectives-2">Learning Objectives:</h2>

<ul>
  <li>Know how to look up and grab key attributes of a shapefile in R (extent, CRS)</li>
  <li>Know how to look up and grab key attributes of a raster in R (extent, CRS)</li>
  <li>Understand CRS (coordinate reference systems)</li>
  <li>Know how to reproject files when they don’t line up</li>
  <li>
    <p>Understand the files associated with a shapefile.</p>

    <p>#might have stuff about storing data
  #stuff on the files associated with a shapefile</p>

    <p>#in this case, our data are organized by
  #metric or type of data and then location then year. 
  #thinking about organizing data is important.</p>

    <p>#crs and metadata in the geospatial world is also important…</p>
  </li>
</ul>

<h1 id="p4-working-with-csv-format-time-series-data">P4. Working with CSV format Time Series Data</h1>

<p><strong>Goal:</strong> Participants will know how to open, clean and plot quantitative time series data within  a text file.</p>

<h2 id="learning-objectives-3">Learning Objectives:</h2>

<ul>
  <li>Participants will know how to open a csv file in R</li>
  <li>How to convert a time field to a time class</li>
  <li>How to convert from date to Julian days.</li>
  <li>Remove NA values from a dataset (clean the data)</li>
  <li>Create a plot using GGPLOT</li>
  <li>Plot multiple variables on one plot</li>
</ul>

<p>Below are the time series data.</p>

<pre><code>#load ggplot for plotting 
library(ggplot2)
#the scales library supports breaks and formatting in ggplot
library(scales)

#don't load strings as factors
options(stringsAsFactors = FALSE)
</code></pre>

<h2 id="dealing-with-date-and-time">Dealing with Date AND time</h2>
<p>SUGGESTION - we should subset this out for just a few years to begin with. I’d recommend 2009-2011
Otherwise it is too big to work with.</p>

<pre><code>#read in 15 min average data
harMet &lt;- read.csv(file="AtmosData/HARV/hf001-10-15min-m.csv")

#clean up dates
#remove the "T"
#harMet$datetime &lt;- fixDate(harMet$datetime,"America/New_York")

# Replace T and Z with a space
harMet$datetime &lt;- gsub("T|Z", " ", harMet$datetime)
  
#set the field to be a date field
harMet$datetime &lt;- as.POSIXct(harMet$datetime,format = "%Y-%m-%d %H:%M", 
                          tz = "GMT")

#list of time zones
#https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
#convert to local time for pretty plotting
attributes(harMet$datetime)$tzone &lt;- "America/New_York"

#subset out some of the data - 2010-2013 
yr.09.11 &lt;- subset(harMet, datetime &gt;= as.POSIXct('2009-01-01 00:00') &amp; datetime &lt;=
as.POSIXct('2011-01-01 00:00'))

#as.Date("2006-02-01 00:00:00")
#plot Some Air Temperature Data
  
myPlot &lt;- ggplot(yr.09.11,aes(datetime, airt)) +
           geom_point() +
           ggtitle("15 min Avg Air Temperature\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Air Temperature")

#format x axis with dates
myPlot + scale_x_datetime(labels = date_format("%m/%d/%y"))

## Warning: Removed 2 rows containing missing values (geom_point).
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/import-harvard-met-data-15min-1.png" alt=" " /></p>

<h3 id="convert-the-data-to-daily-average">convert the data to daily average</h3>

<pre><code>#convert to daily  julian days
temp.daily &lt;- aggregate(yr.09.11["airt"], format(yr.09.11["datetime"],"%Y-%j"),
                 mean, na.rm = TRUE) 


#not working yet - weird!
#qplot(temp.daily$datetime,temp.daily$airt)
#ggplot(temp.daily,aes(datetime, airt)) +
#           geom_point() +
#           ggtitle("Daily Avg Air Temperature\nHarvard Forest") +
#           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
#          theme(text = element_text(size=20)) +
#           xlab("Time") + ylab("Mean Air Temperature")

#format x axis with dates
#myPlot + scale_x_date(labels = date_format("%m/%d/%y"))
</code></pre>

<h2 id="dealing-with-just-date">Dealing with just date.</h2>

<p>the POSIX format is good to go over…One option could be to do the averaging to 
daily on the data above. But you might need to smooth it so it could get complicated?</p>

<p>But calculating a daily average could be very useful! Just in case - we can include the daily average with the data if people get hung up or we need to skip over that part. I think we should do it.</p>

<pre><code>#read in daily data
harMetDaily &lt;- read.csv(file="AtmosData/HARV/hf001-06-daily-m.csv")

  
#set the field to be a date field
harMetDaily$date &lt;- as.Date(harMetDaily$date, format = "%Y-%m-%d")

#subset out some of the data - 2010-2013 
yr.09.11_monAvg &lt;- subset(harMetDaily, date &gt;= as.Date('2009-01-01') &amp; date &lt;=
as.Date('2011-01-01'))

#as.Date("2006-02-01 00:00:00")
#plot Some Air Temperature Data
  
myPlot &lt;- ggplot(yr.09.11_monAvg,aes(date, airt)) +
           geom_point() +
           ggtitle("Daily Air Temperature\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Air Temperature")

#format x axis with dates
myPlot + scale_x_date(labels = date_format("%m/%d/%y"))
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/read-Daily-avg-1.png" alt=" " /></p>

<pre><code>#plot Some Air Temperature Data
  
myPlot &lt;- ggplot(yr.09.11_monAvg,aes(date, prec)) +
           geom_point() +
           ggtitle("Daily Precipitation\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Air Temperature")

#format x axis with dates
myPlot + scale_x_date(labels = date_format("%m/%d/%y"))
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/read-Daily-avg-2.png" alt=" " /></p>

<pre><code>#plot Some Air Temperature Data
  
myPlot &lt;- ggplot(yr.09.11_monAvg,aes(date, part)) +
           geom_point() +
           ggtitle("Daily Avg Total PAR\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Total PAR")

#format x axis with dates
myPlot + scale_x_date(labels = date_format("%m/%d/%y"))

## Warning: Removed 1 rows containing missing values (geom_point).
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/read-Daily-avg-3.png" alt=" " /></p>

<h3 id="plot-soil-temperature">plot soil temperature</h3>

<pre><code>#
#plot soil temp data 
  
myPlot &lt;- ggplot(yr.09.11_monAvg,aes(date, s10t)) +
           geom_point() +
           ggtitle("Daily Avg Soil Temp\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Soil Temp")

#format x axis with dates
myPlot + scale_x_date(labels = date_format("%m/%d/%y"))
</code></pre>

<p><img src="/images/rfigs/2015-10-15-spatio-temporal-data-workshop/soil-temp-1.png" alt=" " /></p>

<h3 id="convert-to-julian-days">Convert to Julian days</h3>

<h2 id="look-at-day-length-data-for-harvard">Look at Day Length Data for Harvard</h2>

<p>NOTE - i need to get the data from 2009-2011 to align with the Landsat Time Series</p>

<pre><code>#load the lubridate package to work with time
library(lubridate)
#readr is ideal to open fixed width files (faster than utils)
library(readr)

#read in fixed width file  
dayLengthHar2011 &lt;- read.fwf(
  file="precip_Daylength/Petersham_Mass_2011.txt",
  widths=c(8,9,9,9,9,9,9,9,9,9,9,9,9))

## Warning in file(file, "rt"): cannot open file 'precip_Daylength/
## Petersham_Mass_2011.txt': No such file or directory

## Error in file(file, "rt"): cannot open the connection

names(dayLengthHar2011) &lt;- c("Day","Jan","Feb","Mar","Apr",
                             "May","June","July","Aug","Sept",
                             "Oct","Nov","Dec") 

## Error in names(dayLengthHar2011) &lt;- c("Day", "Jan", "Feb", "Mar", "Apr", : object 'dayLengthHar2011' not found

#open file  
#dayLengthHar2015 &lt;- read.csv(file = "precip_Daylength/Petersham_Mass_2009.txt", stringsAsFactors = FALSE)

#just pull out the columns with time information
tempDF &lt;- dayLengthHar2011[,2:13]

## Error in eval(expr, envir, enclos): object 'dayLengthHar2011' not found

tempDF[] &lt;- lapply(tempDF, function(x){hm(x)$hour + hm(x)$minute/60})

## Error in lapply(tempDF, function(x) {: object 'tempDF' not found

#populate original DF with the new time data in decimal hours 
dayLengthHar2011[,2:13] &lt;- tempDF

## Error in eval(expr, envir, enclos): object 'tempDF' not found

#plot One MOnth of  data
ggplot(dayLengthHar2011, aes(Day, Jan)) +
  geom_point()+
  ggtitle("Day Length\nJan 2009") +
  xlab("Day of Month") + ylab("Day Length (Hours)") +
  theme(text = element_text(size=20))

## Error in ggplot(dayLengthHar2011, aes(Day, Jan)): object 'dayLengthHar2011' not found
</code></pre>

<h3 id="convert-to-julian-days-and-plot">Convert to Julian Days and Plot</h3>

<p>Next, plot full year’s worth of daylength for 2011.
Note: this could be turned into a function to do multiple files.</p>

<pre><code>#convert to julian days

#stack the data frame
dayLengthHar2011.st &lt;- stack(dayLengthHar2011[2:13])

## Error in stack(dayLengthHar2011[2:13]): error in evaluating the argument 'x' in selecting a method for function 'stack': Error: object 'dayLengthHar2011' not found

#remove NA values
dayLengthHar2011.st &lt;- dayLengthHar2011.st[complete.cases(dayLengthHar2011.st),]

## Error in eval(expr, envir, enclos): object 'dayLengthHar2011.st' not found

#add julian days (count)
dayLengthHar2011.st$JulianDay&lt;-seq.int(nrow(dayLengthHar2011.st))

## Error in nrow(dayLengthHar2011.st): error in evaluating the argument 'x' in selecting a method for function 'nrow': Error: object 'dayLengthHar2011.st' not found

#fix names
names(dayLengthHar2011.st) &lt;- c("Hours","Month","JulianDay")

## Error in names(dayLengthHar2011.st) &lt;- c("Hours", "Month", "JulianDay"): object 'dayLengthHar2011.st' not found

#plot Years Worth of  data
ggplot(dayLengthHar2011.st, aes(JulianDay,Hours)) +
  geom_point()+
  ggtitle("Day Length\nJan 2011") +
  xlab("Julian Days") + ylab("Day Length (Hours)") +
  theme(text = element_text(size=20))

## Error in ggplot(dayLengthHar2011.st, aes(JulianDay, Hours)): object 'dayLengthHar2011.st' not found
</code></pre>

<h1 id="p5-data-viz">P5. Data Viz</h1>

<p>Goal: Participants will know how create and customize maps of spatial data. Participants will know how to create multi-variable plots of spatial data.</p>

<p>Learning Objectives:</p>

<ul>
  <li>Know how to create and customize a map in R</li>
  <li>Know how to plot multiple variables on a plot in R</li>
</ul>

<p>Tasks:
Create a classified map from a raster (tree height?) - (basic classification, mapping)
Customizing a map
Dealing with CRS issues (things don’t line up)
Converting to online (leaflet?)
Plot.ly for time series??
creating layouts with multiple plots</p>

<p>BE creative - have a look at the data. it might be cool for this group to put together 
the NDVI time series and other variables. Then make some cool maps and do something
online (leaflet, plot.ly)</p>

<pre><code>#Here are things to work on

# Creating a Map in r with a legend and multiple elements
# import the RGB base image, the shapefile, color the shapefile by atttibute
# add teh point, customize symbology, colors, labels, title, etc, add a north arrow
# SO imagine a GIS work flow but do that in R.

# Create a leaflet map showing something?? (optional but could be cool. would require
#converting to geojson potentially)

#customizing Ggplots and adding multiple variables that are different 
#IE the dataframes can't be stacked.
</code></pre>

<h1 id="p7-an-automated-workflow">P7. An automated workflow</h1>

<p>What if we wanted to turn the workflow above into a series of loops and functions that handled the data for multiple sites. What if we added an additional year’s worth of dat
to each site?</p>

<p>processing the above for multiple sites – automating spatial analysis workflow in R</p>

<pre><code>#end of section
</code></pre>

<h1 id="remote-sensing-workshop">Remote Sensing Workshop</h1>

<p>This group will build on items on the portal
They will consider the arc of skillsets needed to work with HSI imagery and lidar
starting from beginner to advanced. the materials below might fall somewhere in the middle
with some beginner stuff?</p>

<p>http://neondataskills.org/HDF5/</p>

<p>http://neondataskills.org/lidar/</p>





<!-- The code directly below is required to generate tags and categories at the page bottom-->



<!-- This code generates the category link at the bottom of the page-->

		
            
        

        
            
        

<!-- remove the stuff above if the site slows down - this is to populate tags -->


      <hr />
      

	
</ul>
</div>

      <footer role="contentinfo">
        <div class="article-author-bottom">
          

	 <img src="http://localhost:4000/images/profilePic.png" class="bio-photo" alt="NEON / Data Carpentry Hackathon bio photo"></a>



<h3>NEON / Data Carpentry Hackathon</h3>
<p>Devoted to open data and open source in science and education.</p>


<h3>Activities By Topic</h3>


  
    
      <h5><a href="/module-1">Raster and Vector Data  
    
  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
      <h5><a href="/module-2">Spatial Data Viz - Maps  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
      <h5><a href="/module-3">Time Series  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
  
    
      <h5><a href="/module-4">Remote Sensing  
    
   
      (1) 
     </a></h5>
 

<!--
<h4><a href="/activities/">View ALL Activities</a></h4>
<h4><a href="/activities-by-tag/">Activities by Tag</a></h4>

-->
<br><br><br>









<a href="http://github.com/lwasser" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>







<br><br><br>

        </div>
        <p class="byline id="post-meta"><strong>Spatio-Temporal / NEON Data Workshop </strong> was 
       on <time datetime="2015-10-15T04:00:00-06:00">October 15, 2015</time> by .  <a href="http://localhost:4000/about" title="About NEON / Data Carpentry Hackathon">About NEON / Data Carpentry Hackathon</a>.</p>
      </footer>


    <!-- /.article-wrap -->

  

  </div>
  </article>
</div><!-- /#main -->



<div class="footer-wrap">
  <div class="related-articles">
  <!-- <h4>You might also enjoy <small class="pull-right">(<a href="http://localhost:4000/posts/">View all activities</a>)</small></h4> -->
<h2><a>Related Content:</a></h2>

    

    

    

    

    

    

    

  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2015 National Ecological Observatory Network (NEON) -- Boulder, Colorado. <a href="http://www.neoninc.org" target=_blank></a>
We love feedback! Email: lwasser at neoninc.org or tweet @leahawasser .

<p>Powered by <a href="http://jekyllrb.com">Jekyll</a> A huge shot out to creator of the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</p></span>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52746937-1', 'auto');
  ga('send', 'pageview');

</script>
  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52746937-1', 'auto');
  ga('send', 'pageview');

</script>






</body>
</html>
